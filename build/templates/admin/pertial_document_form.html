<form id="articleForm" method="post"
      action="{% if edit_mode %}{{ url_for('admin_document.edit_article', id=article['id']) }}{% else %}{{ url_for('admin_document.add_article') }}{% endif %}">

    <input type="hidden" name="id" value="{% if edit_mode %}{{ article['id'] }}{% endif %}">
    <input type="hidden" name="edit" value="{% if edit_mode %}1{% else %}0{% endif %}">

    <button type="button" id="duplicate-button" class="btn btn-warning">Duplicate</button>
    <button type="submit" id="save-button" class="btn btn-success">
        {% if edit_mode %}Update{% else %}Add{% endif %}
    </button>

    <div class="row mt-3">

        <!-- Category -->
        <div class="col-md-2 mb-3">
            <label for="category" class="form-label">Category</label>
            <select class="form-select" name="category" id="category" required>
                <option value="">--Select Category--</option>

                {% for cat in categories %}
                    <option value="{{ cat }}"
                        {% if edit_mode and article['category'] == cat %}selected{% endif %}>
                        {{ cat }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Section -->
        <div class="col-md-1 mb-3">
            <label for="section" class="form-label">Section</label>
            <input type="text" class="form-control" name="section" id="section"
                   value="{% if edit_mode %}{{ article['section'] }}{% endif %}"
                   placeholder="Section" required>
        </div>

        <!-- Old Section -->
        <div class="col-md-2 mb-3">
            <label for="old_section" class="form-label">Old Section</label>
            <select name="old_section" id="old_section" class="form-control select2">
                <option value="">-- Select Old Section --</option>

                {% for sec in sections %}
                    <option value="{{ sec }}"
                        {% if edit_mode and article['old_section'] == sec %}selected{% endif %}>
                        {{ sec }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Assessment Year -->
        <div class="col-md-2 mb-3">
            <label for="assessment_year" class="form-label">Assessment Year</label>
            <select class="form-control select2" id="assessment_year" name="assessment_year" required>
                <option value="">Select Year</option>

                {% for year in assessment_years %}
                    <option value="{{ year }}"
                        {% if edit_mode and article['assessment_year'] == year %}selected{% endif %}>
                        {{ year }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <!-- Title -->
        <div class="col-md-5 mb-3">
            <label for="title" class="form-label">Title</label>
            <input type="text" class="form-control" name="title" id="title"
                   value="{% if edit_mode %}{{ article['title'] }}{% endif %}"
                   placeholder="Title" required>
        </div>

    </div>

    <!-- Content -->
    <div class="mb-3 mt-3">
        <label for="ckeditor" class="form-label">Content</label>
        <textarea class="form-control" name="content" id="ckeditor" placeholder="Content">
            {% if edit_mode %}{{ article['content'] | safe }}{% endif %}
        </textarea>
    </div>

</form>

<!-- CKEditor -->
<script src="{{ url_for('static', filename='ckeditor/ckeditor.js') }}"></script>

<script>
    function initCKEditor() {
        if (CKEDITOR.instances['ckeditor']) {
            CKEDITOR.instances['ckeditor'].destroy(true);
        }
        CKEDITOR.replace('ckeditor');
    }

    $(document).ready(function() {
        initCKEditor();

        // Duplicate â†’ create new entry
        $('#duplicate-button').on('click', function() {

            // Set form to add mode
            $('input[name="edit"]').val("0");
            $('input[name="id"]').val("");

            // Change form action
            $("#articleForm").attr("action", "{{ url_for('admin_document.add_article') }}");

            // Update UI labels/buttons
            $("#save-button").text("Add New Entry");

            // Clear dropdown selection for old_section
            $("#old_section").val("").trigger('change');

            // Hide duplicate button
            $(this).hide();
        });
    });
</script>
